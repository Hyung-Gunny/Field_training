<!--파일명: map.html
    프로그램 목적 및 기능:
        - 웹 사이트 화면상에 맵을 보여주고 마커 클릭이나 맵 상에서의 동작을 보여준다.
    프로그램 작성자: 박 형 건 (2024년 1월 12일 (금))
    최종 Update: 2024.01.30
    ===============================================================
    프로그램 수정 및 보완 이력
    ===============================================================
    프로그램 작성자    보완 일자               보완 내용
    박 형 건        2024.1.12(금)        웹 상의 맵을 보여주기
    박 형 건        2024.1.15(월)        웹 상의 맵에 사용자 컨트롤러 추가하기
    박 형 건        2024.1.23(화)        웹 관련 탭을 눌렀을 때 페이지 이동,
                                       맵 위에 마커를 생성
    박 형 건        2024.1.29(월)        웹 상에서의 마커를 클릭 했을 때 팝업
                                       띄우기
    박 형 건        2024.1.30(화)        마커 클릭 시 팝업이 아닌 모달창
                                       띄우기
    ===============================================================
-->
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8" />
    <title>지하 매설물 관리 서비스</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/mapstyle.css}">
    <style>
        /* 모달 스타일만 추가 */
        #modal-container {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid #ccc;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            max-width: 300px;
            text-align: center;
        }

        #modal-content {
            max-width: 100%;
        }

        #modal-close {
            cursor: pointer;
            position: absolute;
            top: 5px;
            right: 10px;
            font-size: 16px;
        }
    </style>
</head>

<body style="margin: 0; padding: 0; height: 100%;">

<!-- 모달 창만 남기고 팝업과 관련된 부분은 주석 처리 -->
<!--
<div id="popup-container">
    <div id="popup-content"></div>
</div>
-->

<div id="modal-container">
    <div id="modal-content">
        <span id="modal-close">&times;</span>
        <!-- 모달 내용이 들어갈 공간 -->
        <p>모달 내용이 여기에 들어갑니다.</p>
    </div>
</div>

<div id="menu-bar">
    <a href="/app">APP</a>
    <a href="/map">지도보기</a>
    <a href="/underground">지하매설관로</a>
    <a href="/realtime-collaboration">실시간 원격협업</a>
</div>

<div class="map_wrap" style="position: relative; height: 100vh;">
    <div id="map" style="width: 100%; height: 100%;"></div>
    <div class="custom_typecontrol radius_border">
        <span id="btnRoadmap" class="selected_btn" onclick="setMapType('roadmap')">지도</span>
        <span id="btnSkyview" class="btn" onclick="setMapType('skyview')">스카이뷰</span>
    </div>
    <div class="custom_zoomcontrol radius_border">
            <span onclick="zoomIn()"><img src="https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/ico_plus.png"
                                          alt="확대"></span>
        <span onclick="zoomOut()"><img src="https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/ico_minus.png"
                                       alt="축소"></span>
    </div>
</div>

<script type="text/javascript"
        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=14739eb7d98a9372eb8d2e8d2e3cf8b4"></script>

<script>
    var mapContainer = document.getElementById('map'),
        mapOption = {
            center: new kakao.maps.LatLng(35.83914, 128.6834),
            level: 3
        };

    var map = new kakao.maps.Map(mapContainer, mapOption);

    var markerPosition = new kakao.maps.LatLng(35.83914, 128.6834);
    var marker = new kakao.maps.Marker({
        position: markerPosition,
        map: map
    });

    var modalContainer = document.getElementById('modal-container');
    var modalContent = document.getElementById('modal-content');
    var modalOpened = false;

    var mapClickEvent = null;

    kakao.maps.event.addListener(marker, 'click', function () {
        openModal();
    });

    function openModal() {
        if (modalOpened) {
            closeModal();
            return;
        }

        modalContent.innerHTML = '<p>모달 내용이 여기에 들어갑니다.</p>';
        modalContainer.style.display = 'block';
        document.getElementById('modal-close').addEventListener('click', closeModal);
        modalOpened = true;
    }

    function closeModal() {
        if (!modalOpened) return;

        modalContainer.style.display = 'none';
        modalContent.innerHTML = '';
        document.getElementById('modal-close').removeEventListener('click', closeModal);
        modalOpened = false;
    }

    function setMapType(maptype) {
        var roadmapControl = document.getElementById('btnRoadmap');
        var skyviewControl = document.getElementById('btnSkyview');
        if (maptype === 'roadmap') {
            map.setMapTypeId(kakao.maps.MapTypeId.ROADMAP);
            roadmapControl.className = 'selected_btn';
            skyviewControl.className = 'btn';
        } else {
            map.setMapTypeId(kakao.maps.MapTypeId.HYBRID);
            skyviewControl.className = 'selected_btn';
            roadmapControl.className = 'btn';
        }
    }

    function zoomIn() {
        map.setLevel(map.getLevel() - 1);
    }

    function zoomOut() {
        map.setLevel(map.getLevel() + 1);
    }
</script>

</body>

</html>
